<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phone Screen: Music</title>
    <link href="/css/palette.css" rel="stylesheet" type="text/css" media="all">
    <link href="css/phoneGlobals.css" rel="stylesheet" type="text/css" media="all">

    <link href="css/music.css" rel="stylesheet" type="text/css" media="all">

    <meta name="description" content="Access literally everything you need." />
    <link rel="icon" type="image/x-icon" href="../Assets/pixels/vintageAmericana/strawberryphone.webp">

    <script src="https://code.iconify.design/iconify-icon/2.1.0/iconify-icon.min.js"></script>
    <script src="js/nowPlaying.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300..700&display=swap" rel="stylesheet">
</head>

<body>
    <object id="detailBarObject" data="detailbar.html"></object>
    <h4>Now Playing</h4>
    <main>
        <div class="detailWrapper">
            <svg class="ProgressC" width="200" height="200" viewBox="0 0 200 200">
                <circle class="ProgressCBgOutline" cx="100" cy="100" r="90" stroke-width="15" />
                <circle class="ProgressCBg" cx="100" cy="100" r="90" stroke-width="10" />
                <circle class="ProgressCBar" cx="100" cy="100" r="90" stroke-width="10" />
            </svg>
            <svg class="ProgressCStar" width="45" height="45" viewBox="0 0 24 24" fill="none"
                xmlns="http://www.w3.org/2000/svg">
                <path class="starPath" fill="#ffffb5" stroke="black" stroke-width="1"
                    d="M9.153 5.408C10.42 3.136 11.053 2 12 2s1.58 1.136 2.847 3.408l.328.588c.36.646.54.969.82 1.182s.63.292 1.33.45l.636.144c2.46.557 3.689.835 3.982 1.776c.292.94-.546 1.921-2.223 3.882l-.434.507c-.476.557-.715.836-.822 1.18c-.107.345-.071.717.001 1.46l.066.677c.253 2.617.38 3.925-.386 4.506s-1.918.051-4.22-1.009l-.597-.274c-.654-.302-.981-.452-1.328-.452s-.674.15-1.328.452l-.596.274c-2.303 1.06-3.455 1.59-4.22 1.01c-.767-.582-.64-1.89-.387-4.507l.066-.676c.072-.744.108-1.116 0-1.46c-.106-.345-.345-.624-.821-1.18l-.434-.508c-1.677-1.96-2.515-2.941-2.223-3.882S3.58 8.328 6.04 7.772l.636-.144c.699-.158 1.048-.237 1.329-.45s.46-.536.82-1.182z" />
            </svg>

            <img id="albumCover" class="albumCover" src="/Assets/other/albumCovers/fallbackCover.jpg" alt="Album Cover">
        </div>

        <div class="songInfoWrapper">
            <div class="timeDisplay">
                <p id="currentTimeDisplay">0:00</p>
                <p id="slash">/</p>
                <p id="durationTimeDisplay">0:00</p>
            </div>

            <p id="songName">Track Name</p>
            <p id="songArtist">Artist</p>
        </div>

        <div class="controlsWrapper">
            <button id="shuffleButton" class="tinyButtons">
                <iconify-icon icon="jam:shuffle"></iconify-icon>
            </button>

            <button id="seekBack" class="buttonsBase">
                <iconify-icon icon="qlementine-icons:seek-backward-16"></iconify-icon>
            </button>

            <button id="MusicPauseButton" class="buttonsBase">
                <iconify-icon icon="line-md:loading-loop"></iconify-icon></iconify-icon>
            </button>

            <button id="seekForward" class="buttonsBase">
                <iconify-icon icon="qlementine-icons:seek-forward-16"></iconify-icon>
            </button>
            <button id="loopButton" class="tinyButtons">
                <iconify-icon icon="radix-icons:loop"></iconify-icon>
            </button>
        </div>

        <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="0.5" title="Volume">
    </main>
</body>


<script>
    // Nightmare Code
    document.addEventListener("DOMContentLoaded", function () {
        setTimeout(function () {
            let audioPlayer = window.top.document.getElementById('globalAudio');
            let currentTimeDisplay = document.getElementById('currentTimeDisplay');

            const songProgressBar = document.querySelector('.ProgressCBar');
            const songDuration = audioPlayer.duration;

            const progressCStar = document.querySelector('.ProgressCStar');
            const starPath = progressCStar.querySelector('path');

            let rotationOffset = 0;
            const rotationsPerSecond = 0.15; // Rotations in place

            starPath.style.transformOrigin = "50% 50%";
            starPath.style.transition = "transform 1s, left 1s, top 1s";

            progressCStar.style.transform = 'translate(0, -90px)';

            const savedDuration = sessionStorage.getItem('songDuration');
            if (savedDuration) {
                document.getElementById('durationTimeDisplay').innerText = savedDuration;
            }

            audioPlayer.addEventListener('timeupdate', function () {
                const currentTime = audioPlayer.currentTime;

                const progress = (currentTime / audioPlayer.duration) * 565;
                songProgressBar.style.strokeDashoffset = 565 - progress;

                const radius = 90;

                const angle = (currentTime / audioPlayer.duration) * 360;

                const radians = (angle - 90) * (Math.PI / 180);

                const starX = radius * Math.cos(radians);
                const starY = radius * Math.sin(radians);

                progressCStar.style.left = '50%';
                progressCStar.style.top = '50%';
                progressCStar.style.transform = `translate(${starX - 20}px, ${starY - 20}px)`;

                rotationOffset += rotationsPerSecond * 360;
                starPath.style.transform = `rotate(${rotationOffset}deg)`;

                const minutes = Math.floor(currentTime / 60);
                const seconds = Math.floor(currentTime % 60);

                currentTimeDisplay.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
            });
        }, 100);

        audioPlayer.addEventListener('loadedmetadata', function () {
            const songIndex = parseInt(sessionStorage.getItem('currentSongIndex')) || 0;
            updateMetadata(songIndex);

            const totalDuration = Math.floor(audioPlayer.duration);
            const minutes = Math.floor(totalDuration / 60);
            const seconds = totalDuration % 60;
            const formattedDuration = `${minutes}:${seconds.toString().padStart(2, '0')}`;

            sessionStorage.setItem('songDuration', formattedDuration);
            document.getElementById('durationTimeDisplay').innerText = formattedDuration;
        });
    });
</script>

</html>